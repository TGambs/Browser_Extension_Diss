/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,n,s={},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return s[e](r,r.exports,o),r.exports}o.m=s,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var s=Object.create(null);o.r(s);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&r;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>i[e]=()=>r[e]);return i.default=()=>r,o.d(s,i),s},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,r)=>(o.f[r](e,t),t),[])),o.u=e=>e+".bundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},n="browser_extension_testing:",o.l=(e,t,s,i)=>{if(r[e])r[e].push(t);else{var a,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+s){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+s),a.src=e),r[e]=[t];var f=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach(e=>e(n)),t)return t(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={471:0};o.f.j=(t,r)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise((r,s)=>n=e[t]=[r,s]);r.push(n[2]=s);var i=o.p+o.u(t),a=new Error;o.l(i,r=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",a.name="ChunkLoadError",a.type=s,a.request=i,n[1](a)}},"chunk-"+t,t)}};var t=(t,r)=>{var n,s,[i,a,c]=r,u=0;if(i.some(t=>0!==e[t])){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);c&&c(o)}for(t&&t(r);u<i.length;u++)s=i[u],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunkbrowser_extension_testing=self.webpackChunkbrowser_extension_testing||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();class a extends Error{constructor(e){let t;t=e instanceof Error?e.message:"string"==typeof e?e:"",super(t),this.name=this.constructor.name}}const c=256,u=3329,l=[2285,2571,2970,1812,1493,1422,287,202,3158,622,1577,182,962,2127,1855,1468,573,2004,264,383,2500,1458,1727,3199,2648,1017,732,608,1787,411,3124,1758,1223,652,2777,1015,2036,1491,3047,1785,516,3321,3009,2663,1711,2167,126,1469,2476,3239,3058,830,107,1908,3082,2378,2931,961,1821,2604,448,2264,677,2054,2226,430,555,843,2078,871,1550,105,422,587,177,3094,3038,2869,1574,1653,3083,778,1159,3182,2552,1483,2727,1119,1739,644,2457,349,418,329,3173,3254,817,1097,603,610,1322,2044,1864,384,2114,3193,1218,1994,2455,220,2142,1670,2144,1799,2051,794,1819,2475,2459,478,3221,3021,996,991,958,1869,1522,1628],h=[1701,1807,1460,2371,2338,2333,308,108,2851,870,854,1510,2535,1278,1530,1185,1659,1187,3109,874,1335,2111,136,1215,2945,1465,1285,2007,2719,2726,2232,2512,75,156,3e3,2911,2980,872,2685,1590,2210,602,1846,777,147,2170,2551,246,1676,1755,460,291,235,3152,2742,2907,3224,1779,2458,1251,2486,2774,2899,1103,1275,2652,1065,2881,725,1508,2368,398,951,247,1421,3222,2499,271,90,853,1860,3203,1162,1618,666,320,8,2813,1544,282,1838,1293,2314,552,2677,2106,1571,205,2918,1542,2721,2597,2312,681,130,1602,1871,829,2946,3065,1325,2756,1861,1474,1202,2367,3147,1752,2707,171,3127,3042,1907,1836,1517,359,758,1441],f=BigInt(2**32-1),p=BigInt(32);function d(e,t=!1){return t?{h:Number(e&f),l:Number(e>>p&f)}:{h:0|Number(e>>p&f),l:0|Number(e&f)}}function b(e,t=""){if(!Number.isSafeInteger(e)||e<0)throw new Error(`${t&&`"${t}" `}expected integer >0, got ${e}`)}function y(e,t,r=""){const n=(s=e)instanceof Uint8Array||ArrayBuffer.isView(s)&&"Uint8Array"===s.constructor.name;var s;const i=e?.length,o=void 0!==t;if(!n||o&&i!==t)throw new Error((r&&`"${r}" `)+"expected Uint8Array"+(o?` of length ${t}`:"")+", got "+(n?`length=${i}`:"type="+typeof e));return e}function g(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function w(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const m=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])()?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=_(e[t]);return e};function k(e,t={}){const r=(t,r)=>e(r).update(t).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=t=>e(t),Object.assign(r,t),Object.freeze(r)}const v=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),S=BigInt(0),O=BigInt(1),A=BigInt(2),P=BigInt(7),j=BigInt(256),U=BigInt(113),z=[],L=[],E=[];for(let e=0,t=O,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],z.push(2*(5*n+r)),L.push((e+1)*(e+2)/2%64);let s=S;for(let e=0;e<7;e++)t=(t<<O^(t>>P)*U)%j,t&A&&(s^=O<<(O<<BigInt(e))-O);E.push(s)}const K=function(e,t=!1){const r=e.length,n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:r,l:o}=d(e[i],t);[n[i],s[i]]=[r,o]}return[n,s]}(E,!0),x=K[0],I=K[1],C=(e,t,r)=>r>32?((e,t,r)=>t<<r-32|e>>>64-r)(e,t,r):((e,t,r)=>e<<r|t>>>32-r)(e,t,r),N=(e,t,r)=>r>32?((e,t,r)=>e<<r-32|t>>>64-r)(e,t,r):((e,t,r)=>t<<r|e>>>32-r)(e,t,r);class M{constructor(e,t,r,n=!1,s=24){if(Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"posOut",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state32",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enableXOF",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"rounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=s,b(r,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");var i;this.state=new Uint8Array(200),this.state32=(i=this.state,new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)))}clone(){return this._cloneInto()}keccak(){m(this.state32),function(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,s=(t+2)%10,i=r[s],o=r[s+1],a=C(i,o,1)^r[n],c=N(i,o,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],s=e[3];for(let r=0;r<24;r++){const n=L[r],i=C(t,s,n),o=N(t,s,n),a=z[r];t=e[a],s=e[a+1],e[a]=i,e[a+1]=o}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=x[n],e[1]^=I[n]}w(r)}(this.state32,this.rounds),m(this.state32),this.posOut=0,this.pos=0}update(e){g(this),y(e);const{blockLen:t,state:r}=this,n=e.length;for(let s=0;s<n;){const i=Math.min(t-this.pos,n-s);for(let t=0;t<i;t++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,128&t&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){g(this,!1),y(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,s=e.length;n<s;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,s-n);e.set(t.subarray(this.posOut,this.posOut+i),n),this.posOut+=i,n+=i}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return b(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(function(e,t){y(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,w(this.state)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:s,enableXOF:i}=this;return e||=new M(t,r,n,i,s),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=n,e.enableXOF=i,e.destroyed=this.destroyed,e}}const B=(e,t,r,n={})=>k(()=>new M(t,e,r),n),T=B(6,136,32,v(8)),V=B(6,72,64,v(10)),R=(e,t,r,n={})=>k((n={})=>new M(t,e,void 0===n.dkLen?r:n.dkLen,!0),n),F=R(31,168,16,v(11)),$=R(31,136,32,v(12)),X=(D=globalThis,G={},new Proxy(D,{get:(e,t,r)=>t in G?G[t]:D[t],set:(e,t,r)=>(t in G&&delete G[t],D[t]=r,!0),deleteProperty(e,t){let r=!1;return t in G&&(delete G[t],r=!0),t in D&&(delete D[t],r=!0),r},ownKeys(e){const t=Reflect.ownKeys(D),r=Reflect.ownKeys(G),n=new Set(r);return[...t.filter(e=>!n.has(e)),...r]},defineProperty:(e,t,r)=>(t in G&&delete G[t],Reflect.defineProperty(D,t,r),!0),getOwnPropertyDescriptor:(e,t)=>t in G?Reflect.getOwnPropertyDescriptor(G,t):Reflect.getOwnPropertyDescriptor(D,t),has:(e,t)=>t in G||t in D}));var D,G;function H(e){return e%256}function q(e){const t=-32768;return e>=t&&e<=32767?e:e<t?(e+=32769,32767+(e%=65536)):(e-=32768,t+(e%=65536))}function J(e){return e%65536}function Q(e){const t=-2147483648,r=2147483647;return e>=t&&e<=r?e:e<t?(e+=2147483649,r+(e%=4294967296)):(e-=2147483648,t+(e%=4294967296))}function W(e){return e%4294967296}function Y(e,t,r){return $.create({dkLen:e}).update(t).update(new Uint8Array([r])).digest()}function Z(e){let t=W(e[0]);return t|=W(e[1])<<8,t|=W(e[2])<<16,t|=W(e[3])<<24,W(t)}class ee{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_skSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pkSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedUSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedVSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}async generateKeyPair(){await this._setup();try{const e=new Uint8Array(64);return this._api.getRandomValues(e),this._deriveKeyPair(e)}catch(e){throw new a(e)}}async deriveKeyPair(e){await this._setup();try{if(64!==e.byteLength)throw new Error("seed must be 64 bytes in length");return this._deriveKeyPair(e)}catch(e){throw new a(e)}}async encap(e,t){await this._setup();try{if(e.length!==384*this._k+32)throw new Error("invalid encapsulation key");const r=this._getSeed(t),[n,s]=te(r,re(e));return[this._encap(e,r,s),n]}catch(e){throw new a(e)}}async decap(e,t){await this._setup();try{if(e.byteLength!==this._compressedUSize+this._compressedVSize)throw new Error("Invalid ct size");if(t.length!==768*this._k+96)throw new Error("Invalid decapsulation key");const r=t.subarray(0,this._skSize),n=t.subarray(this._skSize,this._skSize+this._pkSize),s=t.subarray(this._skSize+this._pkSize,this._skSize+this._pkSize+32),i=t.subarray(this._skSize+this._pkSize+32,this._skSize+this._pkSize+64),o=this._decap(e,r),[a,c]=te(o,s),u=function(e,t){const r=$.create({dkLen:32}).update(e);return void 0!==t&&r.update(t),r.digest()}(i,e);return 1===function(e,t){if(e.length!=t.length)return 0;const r=new Uint8Array([0]);for(let n=0;n<e.length;n++)r[0]|=e[n]^t[n];const n=new Uint8Array([0]);return n[0]=r[0]^~n[0],n[0]&=n[0]>>4,n[0]&=n[0]>>2,n[0]&=n[0]>>1,n[0]}(e,this._encap(n,o,c))?a:u}catch(e){throw new a(e)}}async _setup(){void 0===this._api&&(this._api=await async function(){if(void 0!==X&&void 0!==globalThis.crypto)return globalThis.crypto;try{const{webcrypto:e}=await o.e(146).then(o.t.bind(o,146,19));return e}catch(e){throw new Error("failed to load Crypto")}}())}_getSeed(e){if(null==e){const e=new Uint8Array(32);return this._api.getRandomValues(e),e}if(32!==e.byteLength)throw new Error("seed must be 32 bytes in length");return e}_deriveKeyPair(e){const t=e.subarray(0,32),r=e.subarray(32,64),[n,s]=this._deriveCpaKeyPair(t),i=re(n),o=new Uint8Array(this._skSize+this._pkSize+64);return o.set(s,0),o.set(n,this._skSize),o.set(i,this._skSize+this._pkSize),o.set(r,this._skSize+this._pkSize+32),[n,o]}_deriveCpaKeyPair(e){const[t,r]=te(e,new Uint8Array([this._k])),n=this._sampleMatrix(t,!1),s=this._sampleNoise1(r,0,this._k),i=this._sampleNoise1(r,this._k,this._k);for(let e=0;e<this._k;e++)s[e]=ce(s[e]),s[e]=le(s[e]),i[e]=ce(i[e]);const o=new Array(this._k);for(let e=0;e<this._k;e++)o[e]=pe(de(n[e],s)),o[e]=ge(o[e],i[e]),o[e]=le(o[e]);const a=new Uint8Array(this._pkSize);for(let e=0;e<this._k;e++)a.set(se(o[e]),384*e);a.set(t,this._skSize);const c=new Uint8Array(this._skSize);for(let e=0;e<this._k;e++)c.set(se(s[e]),384*e);return[a,c]}_encap(e,t,r){const n=new Array(this._k),s=new Uint8Array(384*this._k);for(let t=0;t<this._k;t++)n[t]=ie(e.subarray(384*t,384*(t+1))),s.set(se(n[t]),384*t);if(!function(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(e.subarray(0,s.length),s))throw new Error("invalid encapsulation key");const i=e.subarray(this._skSize),o=this._sampleMatrix(i,!0),a=this._sampleNoise1(r,0,this._k),c=this._sampleNoise2(r,this._k,this._k),u=this._sampleNoise2(r,2*this._k,1)[0];for(let e=0;e<this._k;e++)a[e]=ce(a[e]),a[e]=le(a[e]);const l=new Array(this._k);for(let e=0;e<this._k;e++)l[e]=de(o[e],a),l[e]=we(l[e]),l[e]=ge(l[e],c[e]),l[e]=le(l[e]);const h=function(e){const t=new Array(384).fill(0);let r;for(let n=0;n<32;n++)for(let s=0;s<8;s++)r=-1*q(e[n]>>s&1),t[8*n+s]=r&q(1665);return t}(t);let f=de(n,a);f=we(f),f=ge(f,u),f=ge(f,h),f=le(f);const p=new Uint8Array(this._compressedUSize+this._compressedVSize);return this._compressU(p.subarray(0,this._compressedUSize),l),this._compressV(p.subarray(this._compressedUSize),f),p}_decap(e,t){const r=this._decompressU(e.subarray(0,this._compressedUSize)),n=this._decompressV(e.subarray(this._compressedUSize)),s=this._polyvecFromBytes(t);for(let e=0;e<this._k;e++)r[e]=ce(r[e]);let i=de(s,r);return i=we(i),i=function(e,t){for(let r=0;r<c;r++)e[r]-=t[r];return e}(n,i),i=le(i),function(e){const t=new Uint8Array(32);let r;const n=_e(e);for(let e=0;e<32;e++){t[e]=0;for(let s=0;s<8;s++)r=((J(n[8*e+s])<<1)+J(u/2))/J(u)&1,t[e]|=H(r<<s)}return t}(i)}_sampleMatrix(e,t){const r=new Array(this._k),n=new Uint8Array(2);for(let s=0,i=0;i<this._k;i++){r[i]=new Array(this._k);for(let o=0;o<this._k;o++){t?(n[0]=i,n[1]=o):(n[0]=o,n[1]=i);const a=ne(e,n),u=oe(a.subarray(0,504),504,c);for(r[i][o]=u[0],s=u[1];s<c;){const e=oe(a.subarray(504,672),168,c-s),t=e[0],n=e[1];for(let e=s;e<c;e++)r[i][o][e]=t[e-s];s+=n}}}return r}_sampleNoise1(e,t,r){const n=new Array(r);for(let s=0;s<r;s++)n[s]=ae(Y(this._eta1*c/4,e,t),this._eta1),t++;return n}_sampleNoise2(e,t,r){const n=new Array(r);for(let s=0;s<r;s++)n[s]=ae(Y(this._eta2*c/4,e,t),this._eta2),t++;return n}_polyvecFromBytes(e){const t=new Array(this._k);for(let r=0;r<this._k;r++)t[r]=ie(e.subarray(384*r,384*(r+1)));return t}_compressU(e,t){const r=new Array(4);for(let n=0,s=0;s<this._k;s++)for(let i=0;i<64;i++){for(let e=0;e<4;e++)r[e]=((t[s][4*i+e]<<10)+u/2)/u&1023;e[n++]=H(0|r[0]),e[n++]=H(r[0]>>8|r[1]<<2),e[n++]=H(r[1]>>6|r[2]<<4),e[n++]=H(r[2]>>4|r[3]<<6),e[n++]=H(r[3]>>2)}return e}_compressV(e,t){const r=new Uint8Array(8);for(let n=0,s=0;s<32;s++){for(let e=0;e<8;e++)r[e]=15&H(((t[8*s+e]<<4)+u/2)/u);e[n++]=r[0]|r[1]<<4,e[n++]=r[2]|r[3]<<4,e[n++]=r[4]|r[5]<<4,e[n++]=r[6]|r[7]<<4}return e}_decompressU(e){const t=new Array(this._k);for(let e=0;e<this._k;e++)t[e]=new Array(384);const r=new Array(4);for(let n=0,s=0;s<this._k;s++)for(let i=0;i<64;i++){r[0]=J(e[n+0])|J(e[n+1])<<8,r[1]=J(e[n+1])>>2|J(e[n+2])<<6,r[2]=J(e[n+2])>>4|J(e[n+3])<<4,r[3]=J(e[n+3])>>6|J(e[n+4])<<2,n+=5;for(let e=0;e<4;e++)t[s][4*i+e]=q(W(1023&r[e])*W(u)+512>>10)}return t}_decompressV(e){const t=new Array(384);for(let r=0,n=0;n<128;n++,r++)t[2*n+0]=q(J(15&e[r])*J(u)+8>>4),t[2*n+1]=q(J(e[r]>>4)*J(u)+8>>4);return t}}function te(e,t){const r=V.create().update(e);void 0!==t&&r.update(t);const n=r.digest();return[n.subarray(0,32),n.subarray(32,64)]}function re(e){return T.create().update(e).digest()}function ne(e,t){return F.create({dkLen:672}).update(e).update(t).digest()}function se(e){let t=0,r=0;const n=new Uint8Array(384),s=_e(e);for(let e=0;e<128;e++)t=J(s[2*e]),r=J(s[2*e+1]),n[3*e+0]=H(0|t),n[3*e+1]=H(t>>8)|H(r<<4),n[3*e+2]=H(r>>4);return n}function ie(e){const t=new Array(384).fill(0);for(let r=0;r<128;r++)t[2*r]=q(4095&(J(e[3*r+0])|J(e[3*r+1])<<8)),t[2*r+1]=q(4095&(J(e[3*r+1])>>4|J(e[3*r+2])<<4));return t}function oe(e,t,r){const n=new Array(384).fill(0);let s,i,o=0;for(let a=0;o<r&&a+3<=t;)s=4095&(J(0|e[a])|J(e[a+1])<<8),i=4095&(J(e[a+1]>>4)|J(e[a+2])<<4),a+=3,s<u&&(n[o]=s,o+=1),o<r&&i<u&&(n[o]=i,o+=1);return[n,o]}function ae(e,t){let r,n,s,i;const o=new Array(384).fill(0);for(let a=0;a<32;a++){r=Z(e.subarray(4*a,e.length)),n=1431655765&r,n+=r>>1&1431655765;for(let e=0;e<8;e++)s=q(n>>4*e+0&3),i=q(n>>4*e+t&3),o[8*a+e]=s-i}return o}function ce(e){for(let t=0,r=1,n=128;n>=2;n>>=1)for(let s=0;s<256;s=t+n){const i=l[r];for(r+=1,t=s;t<s+n;t++){const r=ue(i,e[t+n]);e[t+n]=e[t]-r,e[t]=e[t]+r}}return e}function ue(e,t){return fe(e*t)}function le(e){for(let t=0;t<c;t++)e[t]=he(e[t]);return e}function he(e){let t=16778880.5/u*e>>24;return t*=u,e-t}function fe(e){let t=q(62209*Q(e))*u;return t=e-t,t>>=16,q(t)}function pe(e){for(let t=0;t<c;t++)e[t]=fe(Q(e[t])*Q(1353));return e}function de(e,t){let r,n=be(e[0],t[0]);for(let s=1;s<e.length;s++)r=be(e[s],t[s]),n=ge(n,r);return le(n)}function be(e,t){let r,n;for(let s=0;s<64;s++)r=ye(e[4*s+0],e[4*s+1],t[4*s+0],t[4*s+1],l[64+s]),n=ye(e[4*s+2],e[4*s+3],t[4*s+2],t[4*s+3],-l[64+s]),e[4*s+0]=r[0],e[4*s+1]=r[1],e[4*s+2]=n[0],e[4*s+3]=n[1];return e}function ye(e,t,r,n,s){const i=new Array(2);return i[0]=ue(t,n),i[0]=ue(i[0],s),i[0]+=ue(e,r),i[1]=ue(e,n),i[1]+=ue(t,r),i}function ge(e,t){const r=new Array(384);for(let n=0;n<c;n++)r[n]=e[n]+t[n];return r}function we(e){let t=0;for(let r=0,n=2;n<=128;n<<=1)for(let s=0;s<256;s=t+n){const i=h[r];for(r+=1,t=s;t<s+n;t++){const r=e[t];e[t]=he(r+e[t+n]),e[t+n]=r-e[t+n],e[t+n]=ue(i,e[t+n])}}for(t=0;t<256;t++)e[t]=ue(e[t],h[127]);return e}function _e(e){for(let t=0;t<c;t++)e[t]-=u,e[t]+=e[t]>>31&u;return e}console.log("\n--- Background.js loading ---");const me=new class extends ee{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*c/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*c/8,this._compressedVSize=this._dv*c/8}};let ke=null,ve=null;chrome.runtime.onMessage.addListener((e,t,r)=>{switch(console.log("Message received in background:",e),e.action){case"genKeys":return async function(){try{const[e,t]=await me.generateKeyPair(),r=btoa(String.fromCharCode(...e)),n=btoa(String.fromCharCode(...t));return ke=e,ve=t,{success:!0,publicKey:r,secretKey:n,publicKeyLength:e.length,secretKeyLength:t.length}}catch(e){return{success:!1,error:e.message}}}().then(r).catch(e=>r({success:!1,error:e.message})),!0;case"randomNumber":return genRandNumber().then(r).catch(e=>r({success:!1,error:e.message})),!0;case"resetStorage":return async function(){try{return await chrome.storage.local.clear(),{success:!0}}catch(e){return{success:!1,error:e.message}}}().then(r).catch(e=>r({success:!1,error:e.message})),!0;case"encryptMessage":return ke?(async function(e,t){const[r,n]=await me.encap(t),s=await async function(e){return await crypto.subtle.importKey("raw",e,{name:"AES-GCM"},!1,["encrypt","decrypt"])}(n),i=crypto.getRandomValues(new Uint8Array(12)),o=(new TextEncoder).encode(e),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},s,o);return{ct:r,encMssg:new Uint8Array(a),iv:i}}(e.payload,ke).then(({ct:e,encMssg:t,iv:n})=>{r({success:!0,ct:btoa(String.fromCharCode(...e)),iv:btoa(String.fromCharCode(...n)),encMssg:btoa(String.fromCharCode(...t))})}).catch(e=>r({success:!1,error:e.message})),!0):(r({success:!1,error:"No pk generated"}),!0);case"getStorage":return async function(){try{const{pubKeys:e,privKeys:t}=await chrome.storage.local.get({pubKey:[],privKey:[]});return console.log("Data fetched from storage"),chrome.storage.local.get(null,e=>{console.table(e)}),{success:!0,pubKeys:e,privKeys:t}}catch(e){console.log("Error getting stored data:",e)}}().then(r).catch(e=>r({success:!1,error:e.message})),!0;case"addStorage":const{pk:t,sk:n}=e.payload;(async function(e,t){try{const{pubKeys:r,privKeys:n}=await chrome.storage.local.get({pubKeys:[],privKeys:[]});r.push(e),n.push(t),await chrome.storage.local.set({pubKeys:r,privKeys:n}),console.log("New data saved to storage")}catch(e){console.log("Storage set data error:",e)}})(t,n).then(r).catch(e=>r({success:!1,error:e.message}));default:return r({success:!1,error:"Unknown action"}),!0}}),console.log("--- Background.js completed ---\n")})();