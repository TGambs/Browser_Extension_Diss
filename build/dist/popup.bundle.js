(()=>{async function e(){try{const e=await chrome.runtime.sendMessage({action:"genKeys"});if(console.log("Response from background:",e),await chrome.runtime.sendMessage({action:"addStorage",payload:{pk:e.publicKey,sk:e.secretKey}}),e.success){const e=await chrome.runtime.sendMessage({action:"getStorage"});console.log("Response from background:",e),n()}else document.getElementById("keyGenOutput").innerHTML=`<strong>Error:</strong> ${e.error}`}catch(e){console.error("Error:",e),document.getElementById("keyGenOutput").innerHTML=`<strong>Error:</strong> ${e.message}`}}async function n(){const e=await chrome.runtime.sendMessage({action:"getStorage"});if(e.success){const{pubKeys:n,privKeys:t}=e;let o=document.getElementById("storageTable");o.innerHTML="",o.innerHTML="\n    <tr>\n    <th>#</th>\n    <th>Public Keys</th>\n    <th>Private Keys</th>\n    </tr>\n    ",n.forEach((e,n)=>{o.innerHTML+=`\n      <tr>\n      <td>${n+1}</td>\n      <td>${e.slice(0,40)}...</td>\n      <td>${t[n].slice(0,40)}...</td>\n      </tr>\n      `}),console.log("--------------"),console.log(n),console.log(t)}else console.error("Error getting storageTable")}async function t(){try{const e=await chrome.runtime.sendMessage({action:"resetStorage"});console.log("Response from background:",e),e.success?n():document.getElementById("storageResetAlert").innerHTML=`<strong>Error:</strong> ${e.error}`}catch(e){console.error(e)}}async function o(){try{const e=document.getElementById("inData").value,n=await chrome.runtime.sendMessage({action:"encryptMessage",payload:e});console.log("Response from background:",n),n.success?(console.log("YES"),document.getElementById("outData").value=JSON.stringify(n,null,2)):console.log("NO")}catch(e){console.error(e)}}function s(e){var t=document.getElementById("mainPgCont"),o=document.getElementById("storagePgCont"),s=document.getElementById("keyPgCont"),c=document.getElementById("faqPgCont");switch(t.style.display="none",o.style.display="none",s.style.display="none",c.style.display="none",e){case 0:t.style.display="block";break;case 1:o.style.display="block";break;case 2:s.style.display="block",n();break;case 3:c.style.display="block"}}console.log("\n--- popup.js loading ---\n"),document.addEventListener("DOMContentLoaded",()=>{s(0);const n=document.getElementById("genKeysBtn");n?(n.addEventListener("click",e),console.log("Key generation button listener attached")):console.error("genKeysBtn not found in DOM");const c=document.getElementById("resetNumsBtn");c?(c.addEventListener("click",t),console.log("storage reset")):console.error("reset button not found");const r=document.getElementById("encBtn");r?(r.addEventListener("click",o),console.log("Encrypt button")):console.error("encrypt button not found");const l=document.getElementById("cpyClip");var a=document.getElementById("outData");l&&l.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(a.value),console.log("Written to clipboard")}catch(e){console.log("Error copying to clipboard:",e)}});const d=document.getElementById("mainBtn");d?(d.addEventListener("click",()=>s(0)),console.log("Nav bttn 0")):console.error("nav bttn 0 not found");const g=document.getElementById("storBtn");g?(g.addEventListener("click",()=>s(1)),console.log("Nav bttn 1")):console.error("nav bttn 1 not found");const i=document.getElementById("keyBtn");i?(i.addEventListener("click",()=>s(2)),console.log("Nav bttn 2")):console.error("nav bttn 2 not found");const u=document.getElementById("faqBtn");u?(u.addEventListener("click",()=>s(3)),console.log("Nav bttn 3")):console.error("nav bttn 3 not found")}),console.log("\n--- popup.js completed ---\n")})();